# ğŸ“˜ GUIDE COMPLET - EduConnect Africa API

## ğŸ¯ Vue d'Ensemble

API REST Django complÃ¨te pour EduConnect Africa avec traÃ§abilitÃ© maximale, soft delete, et versioning des donnÃ©es.

---

## ğŸ“ Architecture du Projet

```
educonnect-api/
â”‚
â”œâ”€â”€ educonnect_api/              # Configuration Django
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py             # Configuration complÃ¨te
â”‚   â”œâ”€â”€ urls.py                 # Routes principales
â”‚   â”œâ”€â”€ asgi.py                 # Configuration ASGI (WebSockets)
â”‚   â”œâ”€â”€ wsgi.py                 # Configuration WSGI
â”‚   â””â”€â”€ celery.py               # Configuration Celery
â”‚
â”œâ”€â”€ apps/                        # Applications Django
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                   # Utilitaires & Base
â”‚   â”‚   â”œâ”€â”€ models.py          # Mixins (Timestamp, SoftDelete, Versioned)
â”‚   â”‚   â”œâ”€â”€ permissions.py     # Permissions personnalisÃ©es
â”‚   â”‚   â”œâ”€â”€ exceptions.py      # Gestionnaire d'exceptions
â”‚   â”‚   â”œâ”€â”€ middleware.py      # Middleware d'activitÃ©
â”‚   â”‚   â””â”€â”€ management/
â”‚   â”‚       â””â”€â”€ commands/
â”‚   â”‚           â”œâ”€â”€ init_db.py         # Initialisation DB
â”‚   â”‚           â””â”€â”€ create_test_data.py # DonnÃ©es de test
â”‚   â”‚
â”‚   â”œâ”€â”€ users/                  # Authentification & Utilisateurs
â”‚   â”‚   â”œâ”€â”€ models.py          # User, UserProfile, UserAvatar, etc.
â”‚   â”‚   â”œâ”€â”€ serializers.py     # User, Registration, Login, Update
â”‚   â”‚   â”œâ”€â”€ views.py           # AuthViewSet
â”‚   â”‚   â”œâ”€â”€ urls.py
â”‚   â”‚   â””â”€â”€ tests.py
â”‚   â”‚
â”‚   â”œâ”€â”€ mentors/                # Gestion Mentors
â”‚   â”‚   â”œâ”€â”€ models.py          # MentorProfile, Bio, Specialties, etc.
â”‚   â”‚   â”œâ”€â”€ serializers.py     # Mentor CRUD
â”‚   â”‚   â”œâ”€â”€ views.py           # MentorViewSet
â”‚   â”‚   â”œâ”€â”€ urls.py
â”‚   â”‚   â””â”€â”€ tests.py
â”‚   â”‚
â”‚   â”œâ”€â”€ bookings/               # SystÃ¨me de RÃ©servation
â”‚   â”‚   â”œâ”€â”€ models.py          # Booking, Domains, Expectations, etc.
â”‚   â”‚   â”œâ”€â”€ serializers.py     # Booking CRUD
â”‚   â”‚   â”œâ”€â”€ views.py           # BookingViewSet
â”‚   â”‚   â”œâ”€â”€ urls.py
â”‚   â”‚   â””â”€â”€ tests.py
â”‚   â”‚
â”‚   â”œâ”€â”€ forum/                  # Questions & RÃ©ponses
â”‚   â”‚   â”œâ”€â”€ models.py          # Question, Answer (versionnÃ©)
â”‚   â”‚   â”œâ”€â”€ serializers.py     # Forum CRUD
â”‚   â”‚   â”œâ”€â”€ views.py           # QuestionViewSet, AnswerViewSet
â”‚   â”‚   â”œâ”€â”€ urls.py
â”‚   â”‚   â””â”€â”€ tests.py
â”‚   â”‚
â”‚   â”œâ”€â”€ gamification/           # Points & Badges
â”‚   â”‚   â”œâ”€â”€ models.py          # Badge, UserBadge, PointsHistory
â”‚   â”‚   â”œâ”€â”€ serializers.py     # Gamification
â”‚   â”‚   â”œâ”€â”€ views.py           # GamificationViewSet
â”‚   â”‚   â”œâ”€â”€ services.py        # BadgeService (logique mÃ©tier)
â”‚   â”‚   â”œâ”€â”€ urls.py
â”‚   â”‚   â””â”€â”€ tests.py
â”‚   â”‚
â”‚   â”œâ”€â”€ messaging/              # Chat Temps RÃ©el
â”‚   â”‚   â”œâ”€â”€ models.py          # Conversation, Message
â”‚   â”‚   â”œâ”€â”€ serializers.py     # Messaging
â”‚   â”‚   â”œâ”€â”€ views.py           # ConversationViewSet
â”‚   â”‚   â”œâ”€â”€ consumers.py       # WebSocket Consumer
â”‚   â”‚   â”œâ”€â”€ urls.py
â”‚   â”‚   â””â”€â”€ tests.py
â”‚   â”‚
â”‚   â”œâ”€â”€ notifications/          # SystÃ¨me de Notifications
â”‚   â”‚   â”œâ”€â”€ models.py          # Notification
â”‚   â”‚   â”œâ”€â”€ serializers.py     # Notification
â”‚   â”‚   â”œâ”€â”€ views.py           # NotificationViewSet
â”‚   â”‚   â”œâ”€â”€ services.py        # NotificationService
â”‚   â”‚   â”œâ”€â”€ urls.py
â”‚   â”‚   â””â”€â”€ tests.py
â”‚   â”‚
â”‚   â”œâ”€â”€ opportunities/          # OpportunitÃ©s (Bourses, Stages)
â”‚   â”‚   â”œâ”€â”€ models.py          # Opportunity
â”‚   â”‚   â”œâ”€â”€ serializers.py     # Opportunity
â”‚   â”‚   â”œâ”€â”€ views.py           # OpportunityViewSet
â”‚   â”‚   â”œâ”€â”€ urls.py
â”‚   â”‚   â””â”€â”€ tests.py
â”‚   â”‚
â”‚   â”œâ”€â”€ ai_tools/               # Tuteur IA
â”‚   â”‚   â”œâ”€â”€ models.py          # AITutorSession, CodeSnippet
â”‚   â”‚   â”œâ”€â”€ serializers.py     # AI Request/Response
â”‚   â”‚   â”œâ”€â”€ views.py           # AIToolsViewSet
â”‚   â”‚   â”œâ”€â”€ urls.py
â”‚   â”‚   â””â”€â”€ tests.py
â”‚   â”‚
â”‚   â””â”€â”€ analytics/              # Analytics (Optionnel)
â”‚       â”œâ”€â”€ models.py          # UserActivity, SystemMetric
â”‚       â””â”€â”€ views.py           # AnalyticsViewSet
â”‚
â”œâ”€â”€ logs/                       # Logs application
â”œâ”€â”€ media/                      # Fichiers uploadÃ©s
â”œâ”€â”€ staticfiles/                # Fichiers statiques collectÃ©s
â”œâ”€â”€ templates/                  # Templates Django
â”‚
â”œâ”€â”€ requirements.txt            # DÃ©pendances Python
â”œâ”€â”€ pytest.ini                  # Configuration pytest
â”œâ”€â”€ conftest.py                 # Fixtures pytest
â”œâ”€â”€ .env.example                # Variables d'environnement
â”œâ”€â”€ Dockerfile                  # Docker image
â”œâ”€â”€ docker-compose.yml          # Docker services
â”œâ”€â”€ deploy.sh                   # Script de dÃ©ploiement
â”œâ”€â”€ manage.py                   # CLI Django
â””â”€â”€ README.md                   # Documentation
```

---

## ğŸš€ Installation & DÃ©marrage

### Option 1: Installation Locale

```bash
# 1. Cloner le projet
git clone <repo-url>
cd educonnect-api

# 2. Environnement virtuel
python3.11 -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate   # Windows

# 3. Installer les dÃ©pendances
pip install -r requirements.txt

# 4. Configuration
cp .env.example .env
# Ã‰diter .env avec vos paramÃ¨tres

# 5. Base de donnÃ©es PostgreSQL
createdb educonnect_db

# 6. Migrations
python manage.py makemigrations
python manage.py migrate

# 7. Initialiser les donnÃ©es
python manage.py init_db

# 8. CrÃ©er un superuser
python manage.py createsuperuser

# 9. (Optionnel) DonnÃ©es de test
python manage.py create_test_data --users 50

# 10. DÃ©marrer le serveur
python manage.py runserver

# 11. DÃ©marrer Celery (dans un autre terminal)
celery -A educonnect_api worker -l info

# 12. DÃ©marrer Channels/Daphne (dans un autre terminal)
daphne -b 0.0.0.0 -p 8001 educonnect_api.asgi:application
```

### Option 2: Avec Docker

```bash
# Build et dÃ©marrer tous les services
docker-compose up --build

# Migrations
docker-compose exec web python manage.py migrate

# Initialiser
docker-compose exec web python manage.py init_db

# CrÃ©er superuser
docker-compose exec web python manage.py createsuperuser

# Voir les logs
docker-compose logs -f web
```

---

## ğŸ“š Endpoints API Complets

### ğŸ” Authentification `/api/auth/`

| MÃ©thode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| POST | `/register/` | Inscription utilisateur | Non |
| POST | `/login/` | Connexion | Non |
| POST | `/token/refresh/` | RafraÃ®chir token | Non |
| GET | `/me/` | Profil actuel | Oui |
| PATCH | `/update_profile/` | Mise Ã  jour profil | Oui |

**Exemple Inscription:**
```json
POST /api/auth/register/
{
  "email": "student@educonnect.africa",
  "password": "SecurePass123!",
  "password_confirm": "SecurePass123!",
  "name": "Jean Dupont",
  "role": "STUDENT",
  "country": "BÃ©nin",
  "university": "UniversitÃ© d'Abomey-Calavi"
}
```

**RÃ©ponse:**
```json
{
  "user": {
    "id": 1,
    "email": "student@educonnect.africa",
    "role": "STUDENT",
    "points": 0,
    "profile": {
      "name": "Jean Dupont",
      "avatar": null,
      "country": "BÃ©nin",
      "university": "UniversitÃ© d'Abomey-Calavi"
    }
  },
  "tokens": {
    "refresh": "eyJ0eXAiOiJKV1QiLCJhbGc...",
    "access": "eyJ0eXAiOiJKV1QiLCJhbGc..."
  }
}
```

---

### ğŸ‘¨â€ğŸ« Mentors `/api/mentors/`

| MÃ©thode | Endpoint | Description | Filtres |
|---------|----------|-------------|---------|
| GET | `/` | Liste mentors | ?search=, ?country=, ?specialty=, ?ordering= |
| GET | `/{id}/` | DÃ©tail mentor | - |
| GET | `/my_profile/` | Mon profil mentor | - |
| PATCH | `/my_profile/` | Mettre Ã  jour | - |
| GET | `/{id}/reviews/` | Avis mentor | - |

**Exemple Liste:**
```bash
GET /api/mentors/?country=BÃ©nin&specialty=Informatique&ordering=-rating
```

---

### ğŸ“… RÃ©servations `/api/bookings/`

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/` | Mes rÃ©servations |
| POST | `/` | CrÃ©er rÃ©servation |
| GET | `/{id}/` | DÃ©tail |
| PATCH | `/{id}/update_status/` | Accepter/Refuser |
| GET | `/mentor_requests/` | Demandes reÃ§ues (mentor) |

**Exemple CrÃ©ation:**
```json
POST /api/bookings/
{
  "mentor_id": 5,
  "date": "2025-12-15",
  "time": "14:00:00",
  "domains": ["Informatique", "Programmation"],
  "expectations": "Je souhaite apprendre les bases de Django",
  "main_question": "Comment structurer un projet Django professionnel?"
}
```

---

### ğŸ’¬ Forum `/api/forum/`

#### Questions

| MÃ©thode | Endpoint | Description | Filtres |
|---------|----------|-------------|---------|
| GET | `/questions/` | Liste | ?search=, ?filter=solved/unsolved, ?tag= |
| POST | `/questions/` | CrÃ©er | - |
| GET | `/questions/{id}/` | DÃ©tail | - |
| PATCH | `/questions/{id}/` | Modifier | - |
| DELETE | `/questions/{id}/` | Supprimer (soft) | - |
| POST | `/questions/{id}/vote/` | Voter | - |
| GET | `/questions/{id}/answers/` | RÃ©ponses | - |
| POST | `/questions/{id}/answers/` | RÃ©pondre | - |

**Exemple CrÃ©ation Question:**
```json
POST /api/forum/questions/
{
  "title": "Comment calculer une intÃ©grale triple?",
  "content": "Je bloque sur cet exercice: âˆ«âˆ«âˆ« xyz dV...",
  "tags": ["mathÃ©matiques", "intÃ©grales", "calcul"]
}
```

#### RÃ©ponses

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| POST | `/answers/{id}/vote/` | Voter |
| POST | `/answers/{id}/accept/` | Accepter (auteur question) |

---

### ğŸ® Gamification `/api/gamification/`

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/leaderboard/` | Classement |
| GET | `/my_badges/` | Mes badges |
| GET | `/all_badges/` | Tous les badges |
| GET | `/points_history/` | Historique points |
| GET | `/stats/` | Statistiques perso |

**SystÃ¨me de Points:**
- Question postÃ©e: **+10 points**
- RÃ©ponse postÃ©e: **+15 points**
- RÃ©ponse acceptÃ©e: **+50 points**
- Upvote reÃ§u: **+5 points**
- Devenir mentor: **+100 points**
- Session complÃ©tÃ©e: **+25 points**

**Badges Disponibles:**
1. ğŸŒ± **Premier Pas** - PremiÃ¨re question
2. ğŸ” **Curieux** - 100 points
3. â­ **EngagÃ©** - 500 points
4. ğŸ† **Expert** - 1000 points
5. ğŸ‘‘ **MaÃ®tre** - 2500 points
6. ğŸ’ **LÃ©gende** - 5000 points

---

### ğŸ’¬ Messagerie `/api/messages/`

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/conversations/` | Mes conversations |
| POST | `/conversations/` | CrÃ©er conversation |
| GET | `/conversations/{id}/` | DÃ©tail |
| GET | `/conversations/{id}/messages/` | Messages |
| POST | `/conversations/{id}/send_message/` | Envoyer |

**WebSocket (Temps RÃ©el):**
```javascript
ws://localhost:8001/ws/chat/{conversation_id}/
```

---

### ğŸ”” Notifications `/api/notifications/`

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/` | Mes notifications |
| GET | `/{id}/` | DÃ©tail |
| POST | `/mark_all_read/` | Tout marquer lu |
| POST | `/{id}/mark_read/` | Marquer lu |
| DELETE | `/{id}/delete_notification/` | Supprimer |
| GET | `/unread_count/` | Nombre non lues |

---

### ğŸ“ OpportunitÃ©s `/api/opportunities/`

| MÃ©thode | Endpoint | Description | Filtres |
|---------|----------|-------------|---------|
| GET | `/` | Liste | ?type=SCHOLARSHIP/CONTEST/INTERNSHIP/TRAINING |
| GET | `/{id}/` | DÃ©tail | - |

---

### ğŸ¤– IA `/api/ai/`

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| POST | `/tutor/` | Tuteur IA |

**Exemple:**
```json
POST /api/ai/tutor/
{
  "question": "Peux-tu m'expliquer le thÃ©orÃ¨me de Pythagore?",
  "subject": "MathÃ©matiques",
  "level": "LycÃ©e"
}
```

---

## ğŸ§ª Tests

```bash
# Lancer tous les tests
pytest

# Tests avec coverage
pytest --cov=apps --cov-report=html

# Tests spÃ©cifiques
pytest apps/users/tests.py
pytest apps/forum/tests.py::TestForum::test_create_question

# Tests verbeux
pytest -v

# Voir la sortie print
pytest -s
```

---

## ğŸ”’ SÃ©curitÃ©

### Headers de SÃ©curitÃ© (Production)

```python
SECURE_SSL_REDIRECT = True
SESSION_COOKIE_SECURE = True
CSRF_COOKIE_SECURE = True
SECURE_HSTS_SECONDS = 31536000
X_FRAME_OPTIONS = 'DENY'
```

### Rate Limiting (Ã€ implÃ©menter)

```python
# settings.py
REST_FRAMEWORK = {
    'DEFAULT_THROTTLE_CLASSES': [
        'rest_framework.throttling.AnonRateThrottle',
        'rest_framework.throttling.UserRateThrottle'
    ],
    'DEFAULT_THROTTLE_RATES': {
        'anon': '100/hour',
        'user': '1000/hour'
    }
}
```

---

## ğŸ“Š Monitoring & Logs

### Logs

```bash
# Logs Django
tail -f logs/django.log

# Logs Gunicorn
tail -f /var/log/gunicorn/error.log

# Logs Nginx
tail -f /var/log/nginx/educonnect_error.log

# Logs Celery
tail -f /var/log/celery/worker.log
```

### Sentry (Monitoring Erreurs)

```python
# settings.py
import sentry_sdk

sentry_sdk.init(
    dsn="your-sentry-dsn",
    environment="production",
    traces_sample_rate=0.1
)
```

---

## ğŸš€ DÃ©ploiement Production

### 1. PrÃ©parer le Serveur

```bash
# Installer dÃ©pendances systÃ¨me
sudo apt update
sudo apt install python3.11 python3.11-venv postgresql redis nginx

# CrÃ©er utilisateur
sudo useradd -m -s /bin/bash educonnect
```

### 2. DÃ©ployer l'Application

```bash
# Cloner
cd /var/www
sudo git clone <repo> educonnect-api
sudo chown -R educonnect:educonnect educonnect-api

# Setup
cd educonnect-api
python3.11 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# Configuration
cp .env.example .env
# Ã‰diter .env avec les vraies valeurs

# Migrations
python manage.py migrate
python manage.py collectstatic --noinput
```

### 3. Configurer Systemd

```bash
# Copier les fichiers service
sudo cp systemd/gunicorn.service /etc/systemd/system/
sudo cp systemd/celery.service /etc/systemd/system/

# Activer et dÃ©marrer
sudo systemctl enable gunicorn celery
sudo systemctl start gunicorn celery
```

### 4. Configurer Nginx

```bash
# Copier la config
sudo cp nginx/educonnect.conf /etc/nginx/sites-available/
sudo ln -s /etc/nginx/sites-available/educonnect.conf /etc/nginx/sites-enabled/

# Tester et recharger
sudo nginx -t
sudo systemctl reload nginx
```

### 5. SSL avec Let's Encrypt

```bash
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d api.educonnect.africa
```

### 6. Script de DÃ©ploiement Automatique

```bash
chmod +x deploy.sh
sudo ./deploy.sh
```

---

## ğŸ”„ Maintenance

### Backup Base de DonnÃ©es

```bash
# Backup manuel
pg_dump educonnect_db > backup_$(date +%Y%m%d).sql

# Backup automatique (cron)
0 2 * * * pg_dump educonnect_db > /var/backups/educonnect/db_$(date +\%Y\%m\%d).sql
```

### Nettoyage

```bash
# Supprimer anciennes versions (soft deleted)
python manage.py shell
>>> from django.utils import timezone
>>> from datetime import timedelta
>>> cutoff = timezone.now() - timedelta(days=90)
>>> # Archiver les donnÃ©es anciennes...
```

---

## ğŸ“– Documentation Interactive

Une fois l'API lancÃ©e:

- **Swagger UI**: http://localhost:8000/api/docs/
- **ReDoc**: http://localhost:8000/api/redoc/
- **Admin Django**: http://localhost:8000/admin/

---

## ğŸ¤ Contribution

1. Fork le projet
2. CrÃ©er une branche feature (`git checkout -b feature/AmazingFeature`)
3. Commit (`git commit -m 'Add AmazingFeature'`)
4. Push (`git push origin feature/AmazingFeature`)
5. Pull Request

---

## ğŸ“ Notes Importantes

### TraÃ§abilitÃ© des DonnÃ©es

- **Aucune suppression physique** : Toutes les suppressions sont des soft deletes
- **Versioning** : Chaque modification crÃ©e un nouvel enregistrement
- **Audit Trail** : Timestamps et historiques complets
- **RÃ©cupÃ©ration** : PossibilitÃ© de restaurer les donnÃ©es

### Performance

- **Indexes** : Sur tous les champs frÃ©quemment filtrÃ©s
- **Pagination** : 20 items par page par dÃ©faut
- **Caching Redis** : Pour sessions et Celery
- **Connection Pooling** : PostgreSQL avec `CONN_MAX_AGE=600`

### ScalabilitÃ©

- **Horizontal** : Ajouter des workers Gunicorn/Celery
- **Vertical** : Augmenter ressources serveur
- **Database** : PostgreSQL supporte des millions de rows
- **CDN** : Pour fichiers statiques/media

---

## ğŸ“ Support

- **Email**: support@educonnect.africa
- **Documentation**: https://docs.educonnect.africa
- **Issues**: https://github.com/hypee/educonnect-api/issues

---

**DÃ©veloppÃ© avec â¤ï¸ par Initiative Hypee - BÃ©nin ğŸ‡§ğŸ‡¯**